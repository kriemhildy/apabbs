<div class="post {{ status }}" id="post-{{ post.key }}">
    {% set role = user.account_opt.role %}
    {% set status = post.status %}
    {###################################################################################}
    {# Body #}
    {###################################################################################}
    {% if post.body|length > 0 and status != "banned" %}
    <div class="body">
        {% if solo and post.youtube %}
        {{ post.body|remove_youtube_thumbnail_links(post.key) }}
        {% else %}
        {{ post.body }}
        {% endif %}
    </div>
    {% endif %}
    {###################################################################################}
    {# Media #}
    {###################################################################################}
    {% if post.media_file_name_opt is not none %}
    {% if status in ["approved", "delisted"] %}
    {% set optimal_file_name =
        post.thumbnail_file_name_opt if not solo and post.thumbnail_file_name_opt is not none
        else post.media_file_name_opt %}
    {% set media_path = "/m/" + post.key + "/" + optimal_file_name|urlencode %}
    {% elif (role in ["admin", "mod"] and status == "pending")
        or (role == "admin" and status == "reported") %}
    {% set media_path = "/decrypt-media/" + post.key %}
    {% endif %}
    {% filter indent(4) %}
    {%+ include "media.jinja" +%}
    {% endfilter %}
    {% endif %}
    {###################################################################################}
    {# Status #}
    {###################################################################################}
    {% if status != "approved" %}
    <div class="status">
        {% if post.media_file_name_opt is not none %}
        File: {{ post.media_file_name_opt|escape }}
        <br>
        {% endif %}
        Status: {{ status|capitalize }}
    </div>
    {% endif %}
    {###################################################################################}
    {# Info #}
    {###################################################################################}
    {% if solo %}
    <div id="created-at">{{ post.created_at_str_opt }}</div>
    {% endif %}
    {###################################################################################}
    {# Arrow #}
    {###################################################################################}
    {% if not solo
        and status not in ["rejected", "banned"]
        and (post.media_category_opt != "image"
            or (status in ["pending", "reported"]
                and role not in ["admin", "mod"]))
        and not post.youtube %}
    <div class="arrow">
        <a href="/{{ post.key }}">&rarr;</a>
    </div>
    {% endif %}
    {###################################################################################}
    {# Review #}
    {###################################################################################}
    {% if (role == "admin" and status in ["pending", "delisted", "reported"])
        or (role == "mod" and status in ["pending", "delisted"])
        or ((role == "admin" or (role == "mod" and post.recent_opt))
            and status == "approved" and solo) %}
    <details class="review">
        <summary>Review</summary>
        <form action="/review/{{ post.key }}" method="post" class="approve" data-fetch>
            <input type="hidden" name="session_token" value="{{ user.session_token }}">
            <input type="hidden" name="status" value="approved">
            <input type="submit" value="Approve"{{ " disabled" if status == "approved" }}>
        </form>
        <form action="/review/{{ post.key }}" method="post" class="delist" data-fetch>
            <input type="hidden" name="session_token" value="{{ user.session_token }}">
            <input type="hidden" name="status" value="delisted">
            <input type="submit" value="Delist"{{ " disabled" if status == "delisted" }}>
        </form>
    {% if role == "mod" %}
        <form action="/review/{{ post.key }}" method="post" class="reported" data-fetch data-confirm>
            <input type="hidden" name="session_token" value="{{ user.session_token }}">
            <input type="hidden" name="status" value="reported">
            <input type="submit" value="Report"{{ " disabled" if status == "reported" }}>
        </form>
    {% elif role == "admin" %}
        <form action="/review/{{ post.key }}" method="post" class="reject" data-fetch data-confirm>
            <input type="hidden" name="session_token" value="{{ user.session_token }}">
            <input type="hidden" name="status" value="rejected">
            <input type="submit" value="Reject"{{ " disabled" if status == "rejected" }}>
        </form>
        <form action="/review/{{ post.key }}" method="post" class="ban" data-fetch data-confirm>
            <input type="hidden" name="session_token" value="{{ user.session_token }}">
            <input type="hidden" name="status" value="banned">
            <input type="submit" value="Ban"{{ " disabled" if status == "banned" }}>
        </form>
    {% endif %}
    </details>
    {% endif %}
    {###################################################################################}
    {# Hide #}
    {###################################################################################}
    {% if status == "rejected" and
        (post.session_token_opt == user.session_token or post.account_id_opt == user.account_opt.id) %}
    <form action="/hide-post" method="post" data-fetch>
        <input type="hidden" name="session_token" value="{{ user.session_token }}">
        <input type="hidden" name="key" value="{{ post.key }}">
        <input type="submit" value="Hide">
    </form>
    {% elif status in ["rejected", "banned"]
        or (status == "reported" and role == "mod") %}
    <button onclick="this.parentElement.remove()">Hide</button>
    {% endif %}
</div>
