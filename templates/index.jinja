{# Main index page template displaying posts and submission form #}
{% extends "layout.jinja" %}
{% block meta %}
    <meta property="twitter:image" content="https://{{ host }}/screenshot.webp?{{ utc_hour_timestamp }}">
    <meta property="twitter:card" content="summary_large_image">
{% endblock %}
{% block title %}
    <title>{{ title }}</title>
{% endblock %}
{% block main %}
<main class="list">
    {% if user.account and user.account.role == "admin" and pending_accounts %}
    <div class="pending-accounts">
        <h2>Pending Accounts</h2>
        <ul>
            {% for account in pending_accounts %}
            <li>
                Approve username "{{ account.username }}"?
                <form action="/review-account" method="post">
                    <input type="hidden" name="session_token" value="{{ user.session_token }}">
                    <input type="hidden" name="username" value="{{ account.username }}">
                    <input type="hidden" name="action" value="approve">
                    <button type="submit">Approve</button>
                </form>
                <form action="/review-account" method="post" data-confirm>
                    <input type="hidden" name="session_token" value="{{ user.session_token }}">
                    <input type="hidden" name="username" value="{{ account.username }}">
                    <input type="hidden" name="action" value="delete">
                    <button type="submit">Delete</button>
                </form>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    {# If viewing a paginated result set, show the page marker #}
    {% if page_post %}
    <p class="system">Page beginning "{{ page_post.key }}"</p>
    {# Otherwise show the post submission form for new content #}
    {% else %}
    {% if user.ban_expires_at %}
    <p class="system">You are banned from posting until {{ user.ban_expires_at }}.</p>
    {% endif %}
    <form action="/submit-post" method="post" enctype="multipart/form-data">
        <fieldset{{ " disabled" if user.ban_expires_at }}>
            {# User session token for authentication/tracking #}
            <input type="hidden" name="session_token" value="{{ user.session_token }}">
            <textarea name="body"></textarea>
            <div class="row">
                <button type="submit" id="post-button">Post</button>
                {# File upload field for images/videos #}
                <input type="file" name="media">
                {# Loading indicator that shows during form submission #}
                <div id="spinner"></div>
            </div>
        </fieldset>
    </form>
    {% endif %}
    {# List of posts #}
    <div id="posts">
        {% filter indent(8) %}
        {%+ for post in posts %}
        {% include "post.jinja" %}
        {% endfor +%}
        {% endfilter %}
    </div>
    {# Pagination control if more posts are available #}
    {% if next_page_post %}
    <footer>
        <p id="next-page"><a href="/page/{{ next_page_post.key }}" class="system">Next page</a></p>
    </footer>
    {% endif %}
</main>
{% endblock %}
