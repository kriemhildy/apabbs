{# Main index page template displaying posts and submission form #}
{% extends "layout.jinja" %}
{% block meta %}
    <meta property="twitter:image" content="https://{{ host }}/screenshot.webp?{{ utc_hour_timestamp }}">
    <meta property="twitter:card" content="summary_large_image">
{% endblock %}
{% block title %}
    <title>{{ title }}</title>
{% endblock %}
{% block main %}
<main class="index">
    {# If viewing a paginated result set, show the page marker #}
    {% if page_post is not none %}
    <p class="system">Page beginning "{{ page_post.key }}"</p>
    {# Otherwise show the post submission form for new content #}
    {% else %}
    {% if user.ban_expires_at is not none %}
    <p class="system">You are banned from posting until {{ user.ban_expires_at }}.</p>
    {% endif %}
    <form action="/submit-post" method="post" enctype="multipart/form-data">
        <fieldset{{ " disabled" if user.ban_expires_at is not none }}>
            {# User session token for authentication/tracking #}
            <input type="hidden" name="session_token" value="{{ user.session_token }}">
            <textarea name="body"></textarea>
            <div class="row">
                {# File upload field for images/videos #}
                <input type="file" name="media">
                <input type="submit" value="Post">
                {# Loading indicator that shows during form submission #}
                <div id="spinner"></div>
            </div>
        </fieldset>
    </form>
    {% endif %}
    {# List of posts #}
    <div id="posts">
        {% filter indent(8) %}
        {%+ for post in posts %}
        {% include "post.jinja" %}
        {% endfor +%}
        {% endfilter %}
    </div>
    {# Pagination control if more posts are available #}
    {% if next_page_post is not none %}
    <footer>
        <p id="next-page"><a href="/page/{{ next_page_post.key }}" class="system">Next page</a></p>
    </footer>
    {% endif %}
</main>
{% endblock %}
