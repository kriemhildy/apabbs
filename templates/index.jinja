<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>schizo.land</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/script.js"></script>
</head>

<body>
    <section id="forms">
        <h1>schizo.land</h1>
        <p class="system">write a post. if approved, it will show up later.</p>
        <form action="/submit-post" method="post">
            <fieldset>
                <legend>new post</legend>
                <textarea name="body"></textarea><br>
                <input type="submit" value="Submit post for review">
            </fieldset>
        </form>
        {%- if user is none %}
        <p class="system">make an account if you want.</p>
        <form action="/login" method="post">
            <fieldset>
                <legend>login/registration</legend>
                <label for="username">username:</label>
                <input type="text" name="username" id="username" maxlength="16"><br>
                <label for="password">password:</label>
                <input type="password" name="password" id="password" maxlength="64"><br>
                <input type="submit" value="Log in or register">
            </fieldset>
        </form>
        <form action="/new-hash" method="post">
            <span class="system">your anon hash: {{ anon_hash }}</span>
            <input type="submit" value="Generate new hash">
        </form>
        {%- else %}
        <form action="/logout" method="post">
            <span class="system">
                logged in user: <strong>{{ user.username }}</strong>
                {%- if user.admin %}
                (admin)
                {%- endif %}
            </span>
            <input type="submit" value="Log out">
        </form>
        {%- endif %}
    </section>
    <main>
        {%- for post in posts %}
        <div class="post {{ post.status }}">
            {%- if post.username %}
            <span class="username">{{ post.username }}</span>
            {%- else %}
            <span class="anon-hash">{{ post.anon_hash }}</span>
            {%- endif %}
            <br>
            <span class="body">{{ post.body }}</span>
            {%- if user.admin and post.status == "pending" %}
            <br>
            <form action="/admin/update-post-status" method="post" id="approve-form">
                <input type="hidden" name="id" value="{{ post.id }}">
                <input type="hidden" name="status" value="approved">
                <input type="submit" value="Approve">
            </form>
            <form action="/admin/update-post-status" method="post" id="reject-form">
                <input type="hidden" name="id" value="{{ post.id }}">
                <input type="hidden" name="status" value="rejected">
                <input type="submit" value="Reject">
            </form>
            {%- elif post.status == "rejected" %}
            <form action="/hide-rejected-post" method="post">
                <span class="system">Post rejected.</span>
                <input type="hidden" name="id" value="{{ post.id }}">
                <input type="submit" value="Hide">
            </form>
            {%- endif %}
        </div>
        {%- endfor %}
    </main>
</body>

</html>