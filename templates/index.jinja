{# Main index page template displaying posts and submission form #}
{% extends "layout.jinja" %}
{% block title %}
    <title>{{ title }}</title>
{% endblock %}
{% block main %}
<main>
    {# If viewing a paginated result set, show the page marker #}
    {% if page_post_opt is not none %}
    {% set page_post = page_post_opt %}
    <p class="system">Page beginning at "{{ page_post.key }}"</p>
    {# Otherwise show the post submission form for new content #}
    {% else %}
    <form action="/submit-post" method="post" enctype="multipart/form-data">
        {# User session token for authentication/tracking #}
        <input type="hidden" name="session_token" value="{{ user.session_token }}">
        <textarea name="body"></textarea>
        <div class="row">
            {# File upload field for images/videos #}
            <input type="file" name="media">
            <input type="submit" value="Post">
            {# Loading indicator that shows during form submission #}
            <div id="spinner"></div>
        </div>
    </form>
    {% endif %}
    {# List of posts #}
    <div id="posts">
        {% filter indent(8) %}
        {%+ for post in posts %}
        {% include "post.jinja" %}
        {% endfor +%}
        {% endfilter %}
    </div>
    {# Pagination control if more posts are available #}
    {% if prior_page_post_opt is not none %}
    {% set prior_page_post = prior_page_post_opt %}
    <p><a href="/page/{{ prior_page_post.key }}" class="system">Prior page</a></p>
    {% endif %}
</main>
{% endblock %}
