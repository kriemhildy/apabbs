{% set category = post.media_category_opt %}
{% set use_thumb = not solo and post.thumb_filename_opt is not none %}
{% set filename = post.thumb_filename_opt if use_thumb else post.media_filename_opt %}
{% set width = post.thumb_width_opt if use_thumb else post.media_width_opt %}
{% set height = post.thumb_height_opt if use_thumb else post.media_height_opt %}
{% set media_path = media_path_opt %}
{% set mime_type = post.media_mime_type_opt %}
<div class="media">
    {% if category == "image" %}
    {% set solo_path = "/post/" + key %}
    {% if solo %}
    <img src="{{ media_path }}" alt="Image {{ filename }}" width="{{ width }}" height="{{ height }}">
    {% else %}
    <a href="{{ solo_path }}"><img src="{{ media_path }}" alt="Post {{ key }}" width="{{ width }}" height="{{ height }}"></a>
    {% endif %}
    {% elif category == "video" %}
    <video width="{{ width }}" height="{{ height }}" controls>
        <source src="{{ media_path }}#t=0.001" type="{{ mime_type }}">
        Video {{ filename }}
    </video>
    {% elif category == "audio" %}
    <audio controls>
        <source src="{{ media_path }}" type="{{ mime_type }}">
        Audio {{ filename }}
    </audio>
    {% endif %}
</div>
