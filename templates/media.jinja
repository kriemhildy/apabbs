{# Media display template for images, videos, and audio files #}
{# Set filename, dimensions and type based on whether to use thumbnail or full media #}
{% set filename = post.thumb_filename_opt if use_thumb else post.media_filename_opt %}
{% set width = post.thumb_width_opt if use_thumb else post.media_width_opt %}
{% set height = post.thumb_height_opt if use_thumb else post.media_height_opt %}
{% set media_path = media_path_opt %}
{% set mime_type = "video/mp4" if use_thumb else post.media_mime_type_opt %}
<div class="media">
    {# Image display handling #}
    {% if category == "image" %}
    {% set solo_path = "/p/" + key %}
    {% if solo %}
    <img src="{{ media_path }}" alt="Image {{ filename }}" width="{{ width }}" height="{{ height }}">
    {% else %}
    <a href="{{ solo_path }}"><img src="{{ media_path }}" alt="Post {{ key }}" width="{{ width }}" height="{{ height }}"></a>
    {% endif %}
    {# Video display handling with poster image #}
    {% elif category == "video" %}
    {% set poster_attr = "" %}
    {% if post.video_poster_opt is not none %}
    {% set poster_filename = post.thumb_filename_opt if use_thumb else post.video_poster_opt %}
    {% set poster_path = "/m/" + key + "/" + poster_filename %}
    {% endif %}
    {% if solo and not chromium %}
    <!-- Non-Chromium browsers receive an 8-bit H.264/AVC video for compatibility -->
    {% endif %}
    <video width="{{ width }}" height="{{ height }}" controls poster="{{ poster_path }}" preload="metadata">
        <source src="{{ media_path }}" type="{{ mime_type }}">
        Video {{ filename }}
    </video>
    {# Audio file display handling #}
    {% elif category == "audio" %}
    <audio controls>
        <source src="{{ media_path }}" type="{{ mime_type }}">
        Audio {{ filename }}
    </audio>
    {% endif %}
</div>
